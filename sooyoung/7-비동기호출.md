# Chapter 7. 비동기 호출

## API 요청

### fetch로 API로 요청하기

- 동일한 API URL을 여러군데에서 사용하게 되면 복붙하여 사용하게 된다.
- 컴포넌트에 깊숙이 자리잡은 비동기 호출코드는 백엔드등에서 기능 변경 요구에 취약하다.

### 서비스 레이어로 분리하기

- 여러 API 요청 정책이 추가되어 코드가 변경 될 수 있다는 것을 감안한다면, 비동기 호출 코드는 컴포넌트 영역에서 분리되어 서비스 레이어에서 처리되어야 한다.

### Axios 활용하기

### Axios 인터셉터 사용하기

- Axios의 인터ㄴ셉터를 사용하면 에러등을 처리할 때 하나의 에러 객체로 묶어서 처리할 수 있다.

### API 응답 타입 지정하기

- API응답 값은 하나의 Response 타입으로 묶일 수 있다.
- UPDATE나 CREATE같이 응답이 없을 수 있는 API를 처리하기 까다로워진다.
- 따라서 Response 타입은 apiRequester가 모르게 관리되어야 한다.

### 뷰 모델(View Model) 사용하기

- API 응답은 변할 가능성이 크다
- 특히 새로운 프로젝트는 서버 스펙이 자주 바뀌기 떄문에 뷰모델을 사용하여 API 변경에 따른 범위를 한정해줘야 한다.
- 흔히 좋은 컴포넌트는 병견될 이유가 하나뿐인 컴포넌트라고 한다.
- 뷰 모델을 만들면 APPI 응당입 바뀌어도 UI가 깨지지 않게 개발할 수 있다.
- 그러나 뷰 모델 방식은 추상화 레이어 추가는 코드를 복잡하게 하고 레이어를 관리하고 개발하는데 비용이 많이든다.

### Superstruct를 사용해 런타임에서 응답 타입 검증하기

## API 상태 관리하기

- 상태 관리 라이브러리로 호출하기
- 훅으로 호출하기

## API 에러 핸들링

### 타입가드 활용하기

- Axios에서 타입가드를 사용할 수 있다.

### 에러 서브클래싱하기

- 에러 서브클래싱이란 기존(상위 또는 부모) 클래스를 확장하여 새로운(하위 또는 자식) 클래스를 만드는 과정을 말한다.
- 새로운 클래스는 상위 클래스의 모든 속성과 메서드를 상속받아 사용할 수 있고 추가적인 속성과 메서드를 정의할 수도 있다.

### 인터셉터를 활용한 에러처리

- Axios 같은 펮칭 라이브러리는 인터셉터 기능을 제공한다.

### 에러 바운더리를 활용한 에러 처리

- 에러 바운더리는 리액트 컴포넌트 트리에서 에러가 발생할 때 공통으로 에러리르 처리하는 리액트 컴포넌트이다.
- 에러 바운더리를 사용하면 리액트 컴포넌트 트리 하위에 있는 컴포넌트에서 발생한 에러를 캐치하고, 해당 에러를 가장 가까운 부모 에러 바운더리에서 처리하게 할 수 있다.

### 상태 관리 라이브리에서의 에러처리

### react-query를 활용한 에러처리

### 그 밖의 에러처리

- if 문을 통해 data.status를 확인하여 처리한ㄷ.

## API 모킹

- 모킹은 가짜 모듈을 활용하는 것을 말한다.
- 서버 상태에 문제가 발생한 경우에도 서버의 영향을 받지 않고 프론트엔드 개발을 할 수 있게 된다.
- JSON 파일 불러오기
- NextApiHandler 활용하기
- API 요청 핸들러에 분기 추가하기
- axios-mock-adapter로 모킹하기
- 목업 사용 여부 제어하기
